<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GitHub Login</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
</head>
<body class="bg-gray-100 min-h-screen flex flex-col">

    <main class="flex-grow flex items-center justify-center p-4">
        <div class="w-full max-w-md">
            <div class="bg-white rounded-lg shadow-md overflow-hidden">
                <div class="p-6">
                    <div class="text-center mb-6">
                        <h2 class="text-2xl font-bold text-gray-800">Login with GitHub</h2>
                        <p class="text-gray-600 mt-2">Access your account using GitHub</p>
                    </div>
                    
                    <!-- 返回主页按钮 -->
                    <div class="mb-4">
                        <a href="/" class="w-full block bg-gray-200 hover:bg-gray-300 text-gray-800 font-medium py-3 px-4 rounded-md transition-colors text-center">
                            <i class="fa fa-arrow-left mr-2"></i>Return to Homepage
                        </a>
                    </div>
                    
                    <!-- GitHub登录按钮 -->
                    <button id="githubLogin" class="w-full bg-gray-800 hover:bg-gray-900 text-white font-medium py-3 px-4 rounded-md transition-colors flex items-center justify-center">
                        <i class="fa fa-github mr-2 text-xl"></i>
                        Login with GitHub
                    </button>
                    
                    <!-- 用户信息显示区域 (登录后显示) -->
                    <div id="userInfo" class="mt-6 hidden">
                        <div class="border-t pt-4">
                            <h3 class="text-lg font-medium text-gray-800 mb-2">You are logged in as:</h3>
                            <div class="flex items-center">
                                <img id="userAvatar" src="" alt="User avatar" class="w-12 h-12 rounded-full mr-4">
                                <div>
                                    <p id="userName" class="font-medium"></p>
                                    <p id="userLogin" class="text-sm text-gray-600"></p>
                                </div>
                            </div>
                            <button id="logoutBtn" class="mt-4 text-blue-600 hover:text-blue-800 text-sm font-medium">
                                Logout
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- 页脚 -->
    <footer class="bg-white py-4 px-6 border-t">
        <div class="container mx-auto text-center text-gray-600 text-sm">
            &copy; 2025 爱分享
        </div>
    </footer>

    <script>
        // 配置参数
        const clientId = 'Ov23lid4wahWfAxWQJAp';
        const redirectUri = 'https://aeafx.dpdns.org/callback.html'; // 替换为你的实际回调地址
        
        // DOM元素
        const githubLoginBtn = document.getElementById('githubLogin');
        const logoutBtn = document.getElementById('logoutBtn');
        const userInfo = document.getElementById('userInfo');
        const userName = document.getElementById('userName');
        const userLogin = document.getElementById('userLogin');
        const userAvatar = document.getElementById('userAvatar');
        
        // 检查用户是否已登录
        function checkLoginStatus() {
            const user = localStorage.getItem('githubUser');
            if (user) {
                const userData = JSON.parse(user);
                // 显示用户信息
                userInfo.classList.remove('hidden');
                githubLoginBtn.classList.add('hidden');
                userName.textContent = userData.name || userData.login;
                userLogin.textContent = `@${userData.login}`;
                userAvatar.src = userData.avatar_url;
                userAvatar.alt = `${userData.login}'s avatar`;
            } else {
                // 显示登录按钮
                userInfo.classList.add('hidden');
                githubLoginBtn.classList.remove('hidden');
            }
        }
        
        // 发起GitHub登录
        function loginWithGitHub() {
            // 生成随机state参数用于CSRF保护
            const state = Math.random().toString(36).substring(2, 15) + Math.random().toString(36).substring(2, 15);
            localStorage.setItem('githubOAuthState', state);
            
            // 构建授权URL
            const authUrl = `https://github.com/login/oauth/authorize?client_id=${clientId}&redirect_uri=${encodeURIComponent(redirectUri)}&state=${state}&scope=user`;
            window.location.href = authUrl;
        }
        
        // 登出
        function logout() {
            localStorage.removeItem('githubUser');
            localStorage.removeItem('githubOAuthState');
            checkLoginStatus();
        }
        
        // 事件监听
        githubLoginBtn.addEventListener('click', loginWithGitHub);
        logoutBtn.addEventListener('click', logout);
        
        // 页面加载时检查登录状态
        document.addEventListener('DOMContentLoaded', checkLoginStatus);
    </script>
</body>
</html>
